FIND_PACKAGE(Threads REQUIRED)

SET(Q330PLUGIN_SOURCES
	q330_plugin.cc
)

SET(Q330_INC ../lib330)
AUX_SOURCE_DIRECTORY(../lib330 LIB330_SOURCES)

INCLUDE_DIRECTORIES(.)
INCLUDE_DIRECTORIES(..)
INCLUDE_DIRECTORIES(../../libs/plugin)

INCLUDE_DIRECTORIES(${Q330_INC})

SET(CONFIG_FILE ${SC3_PACKAGE_INSTALL_PREFIX}/acquisition/config/plugins.ini)

SET(OPTIONS -DSYSLOG_FACILITY=LOG_LOCAL0 -DCONFIG_FILE=\\\"${CONFIG_FILE}\\\")
SET(PLATFORM -D_REENTRANT)
IF(LINUX)
	SET(PLATFORM ${PLATFORM} -DLINUX -Dlinux)
ENDIF(LINUX)

ADD_DEFINITIONS(${OPTIONS} ${PLATFORM})


ADD_EXECUTABLE(q330_plugin ${Q330PLUGIN_SOURCES} ${LIB330_SOURCES})

TARGET_LINK_LIBRARIES(
	q330_plugin
		slplugin
		slutils
		pthread
		${CMAKE_THREAD_LIBS_INIT}
)

INSTALL(TARGETS q330_plugin RUNTIME DESTINATION ${SEEDLINK_PLUGIN_OUTPUT_DIR})

FILE(GLOB descs "${CMAKE_CURRENT_SOURCE_DIR}/descriptions/*.xml")
INSTALL(FILES ${descs} DESTINATION ${SC3_PACKAGE_APP_DESC_DIR})
